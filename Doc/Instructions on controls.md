## 直腿机器人系统建模                               

等效虚拟直腿轮腿机器人。

这一部分看完玺老的分享：[RoboMaster平衡步兵机器人控制系统设计 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/563048952)

本工程与该分享中的建模完全一致，大家先仔细阅读上文章。

## Matlab实现

Matlab主要用来实现LQR中K矩阵求解，本项目和传统LQR控制项目中对K矩阵处理由区别：实际机器人的腿长是会变化的，而在嵌入式平台上每一个控制周期计算一次K矩阵是不切实际的。

在Matlab程序中，将实际能到达的腿长的最小值和最大值间，平均分成多份，每一个长度进行一次K矩阵运算并保存，再使用多项式拟合来得到K矩阵各项与实际腿长的关系，从而把矩阵运算转成多项式运算。

![Matlab流程图](..\Img\Matlab流程图.png)

## 五连杆机器人系统建模

目的是得到沿虚拟腿方向的推力$F$和沿重心轴的力矩$T_p$  ,与两关节电机转矩$T_1、T_2$的关系。

我的解算依旧参考：[五连杆运动学解算与VMC - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/613007726)



## 腿长控制

机器人的$z$轴自由度和$Roll$轴自由度需要改变机器人腿长，机器人的腿长控制主要为一个PIDF（Proportional-Integral-Derivative-Feedforward）控制器实现。

机器人两腿各有一个PIDF控制器，分别控制两腿的虚拟长度，两腿长度配合变化可以改变整车高度和  轴角度等。

![](../Img/腿长控制.png)

**控制逻辑**

**输入期望腿长：** 设置期望的腿长作为控制系统的期望值。

**输入实际腿长：** 获取实际腿长的反馈信息。

**误差计算：** 计算期望腿长和实际腿长之间的误差。

**PID控制器：**通过比例（P）、积分（I）、微分（D）三个环节计算控制输出，输出为力。

**前馈控制：** 将重力值作为前馈输入，以提前补偿系统。

**输出支持力：** 将PID控制器的输出和前馈控制的输出相结合，得到最终的支持力输出。



## 转向设计

轮腿机器人本质上可以简化成一个差速底盘，转向时，差速底盘通过改变每个驱动轮的转速差，来实现转向动作。在此控制系统中，驱动轮电机使用转矩控制，所以最终通过控制驱动轮电机的转矩来控制转向。

这个过程使用PID控制器来实现机器人的转向。首先，通过传感器获取机器人当前的期望角度和实际角度。然后，将这两个角度值输入到PID控制器中，该控制器会计算出两个轮子所需的转矩补偿。接着，将这个转矩补偿作为控制信号叠加到每个轮子的驱动系统，使得两个轮子产生不同的转矩，从而实现车辆的转向动作，使车辆能够准确地响应期望角度的变化，并在运动过程中保持稳定。

![](../Img/转向控制.png)

## 转向双腿同步处理

轮腿机器人的转向环会控制机器人两驱动轮的输出转矩不同，若两个轮子输出的转矩不同，会导致两条腿的运动不同步，出现所谓的“劈叉”现象。具体来说，由于轮子的转矩不均，使得机器人在行走或转向过程中，一条腿运动速度快于另一条腿，造成机器人身体不平衡，呈现出一侧腿向前，另一侧腿向后的情况，即“劈叉”。这种不同步的运动会影响机器人的稳定性和运动效率，甚至可能导致机器人无法顺利移动或转向。因此，解决两轮输出转矩不同的问题对于轮腿机器人的运动控制至关重要。

驱动轮存在转矩差是不可避免的，本项目中通过调整虚拟关节转矩来解决这一问题。本研究的解决方案基于运动学正解方法，通过计算虚拟关节的角度，以及将两腿虚拟关节的角度差作为反馈信号。在此基础上，我们将期望的角度差设置为零，并将其作为输入传入PID控制器中。PID控制器根据当前的角度差与期望值之间的偏差，输出一个虚拟关节的转矩差。该关节转矩差在一定程度上抑制了驱动轮将腿向前后摆动，通过调节这个转矩差，我们实现了两腿的同步运动，从而有效解决了轮腿机器人在转向过程中由于两轮输出转矩不同而导致的不同步问题。这一方法不仅提高了机器人的运动效率和稳定性，也为解决类似问题提供了新的思路和方法。

![](../Img/双腿同步控制.png)
